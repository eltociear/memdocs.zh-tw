---
title: 建立工作順序以安裝 OS
titleSuffix: Configuration Manager
description: 使用 Configuration Manager 中的工作順序，在目的地電腦上自動安裝 OS 映像和其他內容。
ms.date: 07/26/2019
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: 217c8a0e-5112-420e-a325-2a6d75326290
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 6e1b298856edea3f81cab2e9cd5ab75af49dff51
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/21/2020
ms.locfileid: "81707306"
---
# <a name="create-a-task-sequence-to-install-an-os"></a>建立工作順序以安裝 OS

適用於：  Configuration Manager (最新分支)

使用 Configuration Manager 中的工作順序，在目的地電腦上自動安裝 OS 映像。 您建立的工作順序，會參照啟動目的地電腦所使用的開機映像、要安裝在目的地電腦上的 OS 映像，以及要安裝的任何其他內容，例如其他應用程式或軟體更新。 接著您將工作順序部署至包含目的地電腦的集合。  

## <a name="create-a-task-sequence-to-install-an-os"></a><a name="BKMK_InstallOS"></a> 建立工作順序以安裝 OS

將 OS 部署到環境中的電腦有多種案例。 在大部分的情況下，請建立工作順序，然後在 [建立工作順序精靈] 中選取 [安裝現有的映像套件]  。 此選項會建立一個工作順序，以安裝 OS、遷移使用者設定、套用軟體更新，以及安裝應用程式。

### <a name="prerequisites"></a>先決條件

在建立安裝 OS 的工作順序之前，必須先符合下列需求：

#### <a name="required"></a>必要

- [開機映像](../get-started/manage-boot-images.md)  

- [OS 映像](../get-started/manage-operating-system-images.md)  

#### <a name="required-if-used"></a>必要 (如果有用到)

- 同步處理[軟體更新](../../sum/get-started/synchronize-software-updates.md)  

- 新增[應用程式](../../apps/deploy-use/create-applications.md)  

### <a name="process-to-create-a-task-sequence-that-installs-an-os"></a>建立工作順序以安裝 OS 的程序  

1. 在 Configuration Manager 主控台中，移至 [軟體程式庫]  工作區，展開 [作業系統]  ，然後選取 [工作順序]  節點。  

2. 在功能區的 [首頁]  索引標籤上，選取 [建立]  群組中的 [建立工作順序]  。 這個動作會啟動 [建立工作順序精靈]。  

3. 在 [建立新的工作順序]  頁面中選取 [安裝現有的映像套件]  ，然後選取 [下一步]  。  

4. 在 [工作順序資訊]  頁面上指定下列設定：  

    - **工作順序名稱**：指定識別工作順序的名稱。  

    - **描述**：指定工作順序所執行工作的描述。  

    - **開機映像**：指定工作順序用來在目的電腦上安裝 OS 的開機映像。 開機映像包含 Windows PE 的版本，加上任何其他必要的裝置磁碟機。 如需詳細資訊，請參閱[管理開機映像](../get-started/manage-boot-images.md)。  

        > [!IMPORTANT]  
        > 開機映像的架構必須與目的地電腦的硬體架構相容。  

5. 在 [安裝 Windows]  頁面上指定下列設定：  

    - **映像套件**：指定包含要安裝之 OS 映像的套件。 如需詳細資訊，請參閱[管理作業系統映像](../get-started/manage-operating-system-images.md)。  

    - **映像**：如果 OS 映像套件包含多個映像，請指定要安裝之 OS 映像的索引。  

    - **安裝作業系統之前先分割和格式化目標電腦**：指定工作順序是否要在安裝 OS 之前，先分割和格式化目的地電腦。  

    - **產品金鑰**：如有必要，請指定 Windows 產品金鑰。 您可以指定編碼的大量授權金鑰和標準產品金鑰。 如果您使用未編碼的產品金鑰，則每五個字元為一組，之間必須以破折號 (`-`) 來分隔。 例如：*XXXXX-XXXXX-XXXXX-XXXXX-XXXXX*  

    - **伺服器授權模式**：指定伺服器授權為 [按照基座]  、[按照伺服器]  ，或者不指定授權。 如果伺服器授權為 [按照伺服器]  ，請同時指定伺服器連線數目上限。  

    - 指定如何處理新 OS 的管理員帳戶：  

        - **隨機產生本機系統管理員帳戶密碼，並在所有支援的平台上停用帳戶 (建議)** ：Windows 會在工作順序部署 OS 映像後停用本機管理員帳戶。  

        - **啟用帳戶並指定本機系統管理員密碼**：Windows 會在工作順序部署 OS 映像的所有電腦上，對本機管理員帳戶使用相同的密碼。  

6. 在 [設定此網路]  頁面指定下列設定：  

    - **加入工作群組**：將目的電腦新增至工作群組。  

    - **加入網域**：將目的電腦新增至網域。 在 [網域]  中，指定網域名稱。  

        > [!IMPORTANT]  
        > 您可以進行瀏覽，尋找本機樹系中的網域，但是必須指定遠端樹系的網域名稱。  

        您也可以在 [網域 OU]  欄位中指定組織單位 (OU)。 這是選用設定，會指定 OU 的 LDAP X.500 辨別名稱。 如果尚不存在，Windows 會在此 OU 中建立電腦帳戶。  

    - **帳戶**：具有加入指定網域權限之帳戶的使用者名稱和密碼。 例如： *網域\使用者* 或 *%變數%* 。  

        > [!IMPORTANT]  
        > 如果您打算移轉網域設定或工作群組設定，請必須輸入適當的網域認證。  

7. 在 [安裝 Configuration Manager]  頁面上，指定在目的地電腦上安裝 Configuration Manager 用戶端套件。 您也可以包含任何安裝屬性。  

8. 在 [狀態移轉]  頁面上指定下列資訊：  

    - **擷取使用者設定**：工作順序會擷取使用者狀態。 如需如何擷取和還原使用者狀態方式的詳細資訊，請參閱[管理使用者狀態](../get-started/manage-user-state.md)。  

    - **擷取網路設定**：工作順序會從目的地電腦擷取網路設定。 這會擷取網域或工作群組的成員資格，以及網路介面卡設定。  

    - **擷取 Microsoft Windows 設定**：工作順序會在安裝 OS 映像之前，從目的電腦中擷取 Windows 設定。 它會擷取電腦名稱、已註冊的使用者及組織名稱，以及時區設定。  

9. 在 [包含更新]  頁面上，指定要安裝必要的軟體更新、所有軟體更新，或不安裝軟體更新。 如果您指定安裝軟體更新，Configuration Manager 只會將目標軟體更新安裝至目的地電腦為其成員的集合。  

10. 在 [安裝應用程式]  頁面上，指定要安裝在目的地電腦上的應用程式。 如果您指定多個應用程式，也可以指定工作順序在特定應用程式安裝失敗時繼續執行。  

11. 完成精靈。  

您現在可以將工作順序部署到電腦集合。 如需詳細資訊，請參閱 [Deploy a task sequence](deploy-a-task-sequence.md)。


## <a name="pre-cache-content"></a>預先快取內容

<!--4224642-->
從 1906 版開始，您可以啟用這種類型的工作順序來預先快取內容。 工作順序之可用部署的預先快取功能，可讓用戶端在使用者安裝工作順序之前下載相關內容。  

如需詳細資訊，請參閱[設定預先快取內容](configure-precache-content.md)。


## <a name="example-task-sequence"></a><a name="BKMK_InstallExistingOSImageTSExample"></a> 範例工作順序

當您建立工作順序以使用現有映像來部署 OS 時，請使用下表作為指南。 資料表會協助您決定您的工作順序步驟及如何組織和組織成邏輯群組的那些工作順序步驟的一般順序。 您所建立的工作順序可能與此範例不同，而且可能包含更多或更少的工作順序步驟和群組。  

> [!NOTE]  
> 請使用 [建立工作順序精靈] 來建立此工作順序。  
>
> 當您使用 [建立新工作順序精靈] 來建立這個新的工作順序的某些步驟名稱會與它們應該有如果您手動加入這些工作順序步驟到現有的工作順序不同。

|工作順序群組或步驟|說明|  
|---------------------------------|-----------------|  
|擷取檔案和設定 - **(新工作順序群組)**|建立工作序列群組。 工作順序群組會一同保留類似的工作順序步驟，以取得較佳的組織及錯誤控制。<br /><br /> 這個群組包含擷取檔案和設定從參照電腦的作業系統所需的步驟。|  
|擷取 Windows 設定|您可以使用此工作順序步驟來識別要擷取從參照電腦的 Microsoft Windows 設定。 您可以擷取電腦名稱、 使用者和組織資訊和時區設定。|  
|擷取網路設定|您可以使用此工作順序步驟來擷取從參照電腦的網路設定。 您可以擷取參照電腦和網路介面卡設定資訊的網域或工作群組成員資格。|  
|擷取使用者檔案和設定 - **(新工作順序子群組)**|建立工作序列群組內的工作序列群組。 這個子群組包含擷取使用者狀態資料所需的步驟。 類似您新增的初始群組，這個子群組會將類似的工作順序步驟保持在一起，以進一步組織及控制錯誤。|  
|要求使用者狀態存放區|使用此工作順序步驟來要求權限的使用者狀態資料儲存位置的狀態移轉點。 您可以設定此擷取或還原使用者狀態資訊的工作順序步驟。|  
|擷取使用者檔案和設定|使用此工作順序步驟來使用使用者狀態移轉工具 (USMT) 來擷取使用者狀態和設定從參照電腦將會接收與此工作步驟相關聯的工作順序。 您可以擷取標準選項或設定要擷取的 string 選項。|  
|發行使用者狀態存放區|使用此工作順序步驟通知狀態移轉點擷取或還原動作完成時。|  
|安裝作業系統- **(新工作順序群組)**|建立另一個工作順序子群組。 這個子群組包含安裝和設定 Windows PE 環境所需的步驟。|  
|在 Windows PE 中重新啟動|您可以使用此工作順序步驟來指定會接收此工作順序的目的地電腦的重新啟動選項。 此步驟中會顯示訊息給使用者指出如此才能繼續安裝將會重新啟動電腦。<br /><br /> 此步驟中使用唯讀 **_SMSTSInWinPE** 工作順序變數。 如果相關聯的值等於 **false** 工作順序步驟繼續。|  
|磁碟分割磁碟 0|此工作順序步驟指定的動作需要在目的地電腦上的將硬碟格式化。 預設的磁碟編號是 **0**。<br /><br /> 此步驟中使用唯讀 **_SMSTSClientCache** 工作順序變數。 如果 Configuration Manager 用戶端快取不存在，則會執行此步驟。|  
|套用作業系統|您可以使用此工作順序步驟來安裝到目的地電腦上的作業系統映像。 此步驟會先刪除該磁碟區上，除了 Configuration Manager 特定控制檔案之外的任何檔案。 然後，它會將 WIM 檔案中包含的所有磁碟區映像套用至目標電腦上相對應的循序磁碟區。 您可以指定 **sysprep** 回應檔案，也要設定哪一個磁碟分割用來安裝。|  
|套用 Windows 設定|您可以使用此工作順序步驟來設定目的地電腦的 Windows 設定組態資訊。 您可以將套用的 windows 設定是使用者和組織資訊、 產品或授權金鑰資訊、 時區、 和本機系統管理員密碼。|  
|套用網路設定|您可以使用此工作順序步驟來指定目的地電腦的網路或工作群組組態資訊。 您也可以指定電腦使用 DHCP 伺服器是否可靜態指派 IP 位址資訊。|  
|套用裝置驅動程式|使用此工作順序步驟來安裝驅動程式做為作業系統部署的一部分。 您可以讓 Windows 安裝程式來搜尋所有現有的驅動程式類別目錄 **考慮所有類別的驅動程式** 或限制哪些驅動程式類別 Windows 安裝程式會藉由選取搜尋 **限制只考慮選取的類別目錄中的驅動程式的驅動程式比對**。<br /><br /> 此步驟中使用唯讀 **_SMSTSMediaType** 工作順序變數。 只有在變數的值不等於 **FullMedia** 時，才會執行這項工作順序步驟。|  
|套用驅動程式套件|若要讓 Windows 安裝程式可供使用驅動程式套件中所有的裝置驅動程式中使用此工作順序步驟。|  
|安裝作業系統 - **(新工作順序群組)**|建立另一個工作順序子群組。 這個子群組包含設定已安裝作業系統所需的步驟。|  
|[安裝套件]|使用此工作順序步驟來安裝 Configuration Manager 用戶端軟體。 Configuration Manager 會安裝並註冊 Configuration Manager 用戶端 GUID。 您可以在 **[安裝內容]** 視窗中指派必要的安裝參數。|  
|安裝更新|若要指定目的地電腦上安裝軟體更新的方式使用此工作順序步驟。 直到此工作順序步驟執行之後，才會評估目的地電腦是否有適用的軟體更新。 此時，會評估目的電腦是否有類似於任何其他 Configuration Manager 管理用戶端的軟體更新。<br /><br /> 此步驟中使用唯讀 **_SMSTSMediaType** 工作順序變數。 只有在變數的值不等於 **FullMedia** 時，才會執行這項工作順序步驟。|  
|還原使用者檔案和設定 - **(新工作序列子群組)**|建立另一個工作順序子群組。 這個子群組包含還原使用者檔案和設定所需的步驟。|  
|要求使用者狀態存放區|使用此工作順序步驟來要求權限的使用者狀態資料儲存位置的狀態移轉點。|  
|還原使用者檔案和設定|您可以使用此工作順序步驟來執行使用者狀態移轉工具 (USMT) 將使用者狀態和設定還原至目的電腦。|  
|發行使用者狀態存放區|請使用這項工作順序步驟，通知狀態移轉點，不再需要使用者狀態資料。|  
