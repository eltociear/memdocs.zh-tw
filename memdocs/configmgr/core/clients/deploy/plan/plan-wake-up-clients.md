---
title: 喚醒用戶端
titleSuffix: Configuration Manager
description: 規劃如何使用網路喚醒 (WOL) 在 Configuration Manager 中喚醒用戶端。
ms.date: 04/23/2019
ms.prod: configuration-manager
ms.technology: configmgr-client
ms.topic: conceptual
ms.assetid: 52ee82b2-0b91-4829-89df-80a6abc0e63a
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: feea1cdea52b76b900497e84eea210444535fcd8
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/21/2020
ms.locfileid: "81693766"
---
# <a name="plan-how-to-wake-up-clients-in-configuration-manager"></a>規劃如何在 Configuration Manager 中喚醒用戶端

適用於：  Configuration Manager (最新分支)

 Configuration Manager 支援傳統喚醒封包，當您要安裝必要軟體 (如軟體更新和應用程式) 時，能喚醒睡眠模式下的電腦。

> [!NOTE]
> 本文會描述較舊版本的網路喚醒如何運作。 這項功能仍存在於 Configuration Manager 1810 版本之中，該版本也包含網路喚醒的較新版本。 兩個版本的網路喚醒不僅可以，而且在許多情況下，會同時啟用。 如需如何在 1810 版本中啟動較新版網路喚醒功能，以及啟用兩種版本其中之一或同時啟用兩者的詳細資訊，請參閱[如何設定網路喚醒](../configure-wake-on-lan.md)。  

## <a name="how-to-wake-up-clients-in-configuration-manager"></a>如何在 Configuration Manager 中喚醒用戶端

 Configuration Manager 支援傳統喚醒封包，當您要安裝必要軟體 (如軟體更新和應用程式) 時，能喚醒睡眠模式下的電腦。  

您可以使用喚醒 Proxy 用戶端設定來補充傳統喚醒封包方式。 喚醒 Proxy 會使用點對點通訊協定以及選取的電腦，來檢查子網路上的其他電腦是否處於喚醒狀態，並且於必要時將其喚醒。 為網站設定網路喚醒功能以及為用戶端設定喚醒 Proxy 功能的程序如下：  

1. 安裝了 Configuration Manager 用戶端的電腦，以及子網路上並非處於睡眠模式的電腦，會檢查子網路上其他電腦是否處於喚醒狀態。 這些電腦每五秒彼此傳送 TCP/IP Ping 命令來執行這個檢查。  

2. 若其他電腦沒有回應，則會被認為在睡眠狀態。 而醒著的電腦則成為該子網路的「管理員電腦」  。  

    由於電腦可能會因為睡眠狀態以外的其他原因而不回應 (例如電腦關機、已從網路移除，或不再套用 Proxy 喚醒用戶端設定)，所以在每天的當地時間下午 2 點都會傳送喚醒封包。 給電腦。 不會再將不回應的電腦視為睡眠狀態，也不會由喚醒 Poxy 來喚醒。  

    若要支援喚醒 Proxy，每個子網路上應至少有三台電腦是醒著的。 為達成此要求，會以不定方式選擇三部電腦作為子網路的「守護者電腦」  。 此狀態表示即使設定的電源原則在一段時間閒置後進入睡眠或休眠，仍會有三台電腦保持醒著的狀態。 例如，管理員電腦會遵循維護工作結束時的關機或重新啟動命令。 若出現此種狀況，剩下的守護者電腦會喚醒子網路上另一台電腦，讓子網路持續有三台守護者電腦。  

3. 管理員電腦會要求網路交換器將睡眠中電腦的網路流量重新導向自己。  

    此重新導向是由管理員電腦廣播乙太網路框架來完成，該乙太網路框架使用睡眠中電腦的 MAC 位址做為來源位址。 此行為會讓網路交換器的行為彷彿睡眠中的電腦已移到管理員電腦所在的相同連接埠。 管理員電腦也會為睡眠中電腦傳送 ARP 封包，讓 ARP 快取中的項目保持更新。 管理員電腦也會代表睡眠中電腦回應 ARP 要求，並以睡眠中電腦的 MAC 位址回覆。  

   > [!WARNING]  
   >  在這個程序中，睡眠中電腦的 IP 到 MAC 對應仍維持相同。 喚醒 Proxy 的運作方式是通知網路交換器有不同的網路介面卡正在使用已經由另一個網路介面卡登錄的連接埠。 不過，這個行為稱為 MAC Flap (Mac 飄移)，並不是標準網路運作的正常行為。 某些網路監控工具會尋找此行為，並假設有不對勁的情形出現。 因此，這些監控工具可能在您使用喚醒 Proxy 時，產生警示或關閉連接埠。  
   >   
   >  若您的網路監控工具和服務不允許 MAC Flap，就不要使用喚醒 Proxy。  

4. 當管理員電腦發現有針對睡眠中電腦的新 TCP 連線要求，且該要求是傳送至該睡眠中電腦進入睡眠前正在接聽的連接埠時，管理員電腦會向睡眠中電腦傳送喚醒封包，然後停止重新導向此電腦的流量。  

5. 睡眠中電腦會接收喚醒封包，並醒過來。 傳送的電腦會自動重新嘗試連線，這次電腦是醒著的，並且可以進行回應。  

   喚醒 Proxy 具有以下必要條件和限制：  

> [!IMPORTANT]  
>  如果您有個別團隊負責網路基礎結構和網路服務，請在評估與測試期間通知並納入此團隊。 例如，在使用 802.1X 網路存取控制的網路上，喚醒 Proxy 將無法運作，且可能使網路服務中斷。 此外，部分網路監控工具偵測到喚醒其他電腦的流量時，喚醒 Proxy 可能會導致其產生警示。  

-   在[支援的用戶端和裝置作業系統](../../../plan-design/configs/supported-operating-systems-for-clients-and-devices.md)中，列為支援之用戶端的所有 Windows 作業系統都可支援網路喚醒。  

-   不支援在虛擬機器上執行的客體作業系統。  

-   用戶端必須使用用戶端設定來啟用喚醒 Proxy。 儘管喚醒 Proxy 操作並不與硬體清查相依，但除非用戶端啟用硬體清單且提交至少一份硬體清查，否則用戶端不會回報喚醒 Proxy 服務的安裝。  

-   必須針對喚醒封包啟用並設定網路介面卡 (可能也包括 BIOS)。 如果網路介面卡未針對喚醒封包設定，或停用此設定，Configuration Manager 在收到用戶端設定啟用喚醒 Proxy 時，會自動為電腦設定並啟用網路介面卡。  

-   如果電腦有超過一張電腦介面卡，您無法設定以哪一張介面卡用於喚醒 Proxy；選擇是不定的。 不過，選擇的介面卡會記錄在 SleepAgent_<網域\>@SYSTEM_0.log 檔案中。  

-   網路必須允許 ICMP 回應要求 (至少在子網路內)。 您無法設定五秒間隔時間，因為這個間隔是用來傳送 ICMP Ping 命令。  

-   通訊不會加密，也不會驗證，且不支援 IPsec。  

-   不支援以下網路設定：  

    -   具備連接埠驗證的 802.1X  

    -   無線網路  

    -   將 MAC 位址繫結至特定連接埠的網路交換器  

    -   IPv6 專用網路  

    -   DHCP 租用期間少於 24 小時  

如果您想要喚醒電腦進行已排程的軟體安裝，您必須設定每個主要站台使用喚醒封包。  

 若要使用喚醒 Proxy，除了設定主要站台，您還必須部署電源管理喚醒 Proxy 用戶端設定。  

決定是否要使用子網路導向的廣播封包或單點傳播封包，以及使用何種 UDP 連接埠號碼。 根據預設，會使用 UDP 連接埠 9 來傳送傳統喚醒封包，但為了協助提升安全性，您可以為網站選取替代連接埠 (先決條件是中介路由器與防火牆支援該替代連接埠)。  

## <a name="choose-between-unicast-and-subnet-directed-broadcast-for-wake-on-lan"></a>針對網路喚醒，在單點傳播和子網路導向的廣播間做選擇  
 如果您選擇傳送傳統喚醒封包來喚醒電腦，您必須決定要傳送單點傳播封包，還是子網路導向的廣播封包。 如果使用喚醒 Proxy，就必須使用單點傳播封包。 否則，就請使用下表，協助您判斷要選用哪一種傳送方式。  

|傳輸方式|優點|缺點|  
|-------------------------|---------------|------------------|  
|單點傳播|與子網路導向的廣播相比，這是個更安全的解決方案，因為封包是直接傳送到電腦，而不是送到子網路上的所有電腦。<br /><br /> 可能不需要重新設定路由器 (不過可能需要設定 ARP 快取)。<br /><br /> 與子網路導向的廣播傳輸相比，使用的網路頻寬比較少。<br /><br /> 支援 IPv4 和 IPv6。|喚醒封包會找不到上次硬體清查排程後，子網路位址已經變更的目的地電腦。<br /><br /> 可能必須設定切換器以轉寄 UDP 封包。<br /><br /> 部分網路介面卡使用單點傳播做為傳輸方法時，可能不會在各種睡眠狀況下回應喚醒封包|  
|子網路導向的廣播|如果您的電腦經常變更相同子網路中的 IP 位址，這種方法比單點傳播的成功率較高。<br /><br /> 不需要重新設定交換器。<br /><br /> 針對所有睡眠狀態，對電腦介面卡有高相容比率，因為子網路導向的廣播是傳送喚醒封包的原始傳輸方法。|這比使用單點傳播來得更不安全，因為攻擊者可以從偽造來源位址不斷寄送 ICMP 回應請求串流到導向的廣播位址。 這會導致所有主機回覆該來源位址。 如果設定路由器為允許子網路導向的廣播，則建議基於安全性理由，進行其他設定：<br /><br /> -   使用指定的 UDP 連接埠號碼設定路由器，以僅允許來自 Configuration Manager 站台伺服器的 IP 導向廣播。<br />-   設定 Configuration Manager 來使用指定的非預設連接埠號碼。<br /><br /> 可能需要重新設定所有中介路由器以啟用子網路導向的廣播。<br /><br /> 與單點傳播相比，會佔用較多的網路頻寬。<br /><br /> 僅支援 IPv4，不支援 IPv6。|  

> [!WARNING]  
>  具有與子網路導向廣播相關的安全性風險：攻擊者可以從偽造的來源位址不斷將網際網路控制訊息通訊協定 (ICMP) 回應請求的串流傳送到導向的廣播位址，這會導致所有主機回覆該來源位址。 這種阻斷服務的攻擊類型通常稱為 Smurf 攻擊，一般只要不啟用子網路導向的廣播，就可以避免遭到此種攻擊。
