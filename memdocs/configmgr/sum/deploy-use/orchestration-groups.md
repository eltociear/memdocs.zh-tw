---
title: 協調流程群組
titleSuffix: Configuration Manager
description: 建立協調流程群組，並將更新部署到其中。
ms.date: 04/01/2020
ms.prod: configuration-manager
ms.technology: configmgr-sum
ms.topic: conceptual
ms.assetid: cddbebea-b418-4839-b0a8-7809486c8a4c
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: d9998f298cee24e9f10b3fd8c5e58d7b76200485
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/21/2020
ms.locfileid: "81702976"
---
# <a name="orchestration-groups-in-configuration-manager"></a>Configuration Manager 中的協調流程群組
<!--3098816-->
適用於：  Configuration Manager (最新分支)

從 Configuration Manager 2002 版開始，可建立協調流程群組。 建立協調流程群組以使用更好的方式控制裝置的軟體更新部署。 許多伺服器系統管理員都需要更謹慎地管理特定工作負載的更新，並自動化它們之間的行為。

協調流程可讓您依百分比、特定數字或明確順序來彈性地更新裝置。 您也可以在裝置執行更新部署之前或之後執行 PowerShell 指令碼。

協調流程群組的成員可以是任意 Configuration Manager 用戶端，而不只是伺服器。 協調流程群組規則會將所有軟體更新部署的裝置套用到包含協調流程群組成員的任何集合。 其他部署行為仍然適用。 例如，維護時段與部署排程。

> [!NOTE]
> 在這個版本的 Configuration Manager 中，協調流程群組是發行前版本功能。 若要啟用此功能，請參閱[發行前版本功能](../../core/servers/manage/pre-release-features.md)。  
>
> **協調流程群組**功能是從[伺服器群組](service-a-server-group.md)功能演化來的。 協調流程群組是 Configuration Manager 中的物件。

## <a name="orchestration-group-usage-example"></a>協調流程群組使用範例

- 身為軟體更新系統管理員，您會管理您組織中的所有更新。
- 您有所有伺服器一個大型集合，以及所有用戶端的一個大型集合。 您會將所有更新部署到這些集合。
- SQL 系統管理員想要控制 SQL 伺服器上安裝的所有軟體。 他們想要以特定順序修補五部伺服器。 他們目前的程序是在安裝更新之前手動停止特定服務，之後再重新啟動服務。
- 您可以建立協調流程群組並新增全部五部 SQL 伺服器。 您也可以使用 SQL 系統管理員所提供的 PowerShell 指令碼來新增執行前與執行後指令碼。
- 在下次更新週期期間，您能以正常方式建立軟體更新並部署到大型伺服器集合。 SQL 系統管理員會執行部署，而且協調流程群組會將訂單與服務自動化。

## <a name="prerequisites"></a>先決條件

### <a name="site-server-and-permission-prerequisites"></a>站台伺服器和權限先決條件
- 若要查看所有協調流程群組與那些群組的任何更新，您的帳戶需要成為**系統高權限管理員**。
   - 協調流程群組以角色為基礎的系統管理目前無法使用。
- 啟用**協調流程群組**功能。 如需詳細資訊，請參閱[啟用選擇性功能](../../core/servers/manage/install-in-console-updates.md#bkmk_options)。
   - 當您啟用**協調流程群組**時，站台會停用**伺服器群組**功能。 此行為可避免兩個功能之間發生任何衝突。

### <a name="client-prerequisites"></a>用戶端先決條件

- 將目標裝置升級至 Configuration Manager 用戶端的最新版本。
- 協調流程群組的成員應指派給相同站台。
- 裝置不能處於一個以上的協調流程群組中。
   - 新增成員時，已處於協調流程群組中的裝置無法供選取。


## <a name="limitations"></a>限制

- 最多可以有 1000 個協調流程群組成員。
- 協調流程群組無法在互通性模式下運作。 如需詳細資訊，請參閱 [Configuration Manager 不同版本之間的互通性](../../core/plan-design/hierarchy/interoperability-between-different-versions.md#bkmk_mixed)。 <!--6389000-->
- 如果使用者從軟體中心起始更新，則會略過協調流程。 <!--6362887-->

## <a name="server-groups-are-automatically-updated-to-orchestration-groups"></a>伺服器群組自動更新為協調流程群組

**協調流程群組**功能是從[伺服器群組](service-a-server-group.md)功能演化來的。 當安裝 Configuration Manager 2002 版或更新版本，且已啟用伺服器群組時，伺服器群組會自動移至協調流程群組。

## <a name="create-an-orchestration-group"></a>建立協調流程群組

1. 在 Configuration Manager 主控台中，移至 [資產與合規性]  工作區，然後選取 [協調流程群組]  節點。

1. 在功能區中，選取 [建立協調流程群組]  以開啟 [建立協調流程群組精靈]  。

1. 在 [一般]  頁面上，為您的協調流程群組提供 [名稱]  與選擇性的 [描述]  。 為下列項目指定您的值：
   - [Orchestration Group timeout (in minutes] \()協調流程群組逾時 (分鐘)\)  ：所有群組成員完成更新安裝的時間限制。
   - **協調流程群組成員逾時 (分鐘)** ：群組中單一裝置完成更新安裝的時間限制。

1. 在 [成員選取]  頁面上，先指定 [站台碼]  。 接著，選取 [新增]  以新增裝置資源作為此協調流程群組的成員。 依裝置**搜尋**裝置，然後**新增**它們。 您也可以使用 [在集合中搜尋]  將搜尋篩選至單一集合。  當您完成將裝置新增到選取的資源清單時，請選取 [確定]  。
   - 選取群組的資源時，只會顯示有效的用戶端。 已進行檢查來驗證站台碼、已安裝用戶端，以及資源未重複。

1. 在 [規則選取]  頁面上，選取下列其中一個選項：

   - [允許同時更新一部分的電腦]  ，然後選取或輸入此百分比的數字。 使用此設定來允許未來彈性的協調流程群組大小。 例如，您的協調流程群組包含 50 部裝置，而且您將此值設定為 10。 在軟體更新部署期間，Configuration Manager 允許五部裝置同時執行部署。 若您稍後將協調流程群組大小新增為 100 部裝置，則一次可更新 10 部裝置。

   - [允許同時更新多部電腦]  ，然後選取或輸入此特定計數的數字。 使用此設定來一律限制特定裝置數目，不論協調流程群組整體大小為何。

   - [指定維護順序]  ，然後以特定順序將選取的資源排序。 使用此設定來明確定義裝置執行軟體更新部署的特定順序。

1. 在 [更新前指令碼]  頁面上，輸入執行部署「前」  要在每部裝置上執行的 PowerShell 指令碼。 該指令碼會傳回 `0` (代表成功) 或 `3010` (成功但需要重新啟動)。

1. 在 [更新後指令碼]  頁面上，輸入執行部署「後」  要在每部裝置上執行的 PowerShell 指令碼。 行為與 PreScript 相同。

1. 完成精靈。

> [!WARNING]
> 請先確定更新前指令碼和更新後指令碼已經過測試，再將其用於協調流程群組。 更新前指令碼和更新後指令碼不會逾時，而是會一直執行到協調流程群組成員逾時為止。

## <a name="view-orchestration-groups-and-members"></a>檢視協調流程群組與成員

從 [資產與合規性]  工作區中，選取 [協調流程群組]  節點。 若要檢視成員，請選取協調流程群組，然後選取功能區中的 [顯示成員]  。 如需節點可用資料行的詳細資訊，請參閱[監視協調流程群組與成員](#bkmk_orch_monitor)。

## <a name="edit-or-delete-an-orchestration-group"></a>編輯或刪除協調流程群組

若要刪除協調流程群組，請選取協調流程群組，然後按一下功能區或右鍵功能表中的 [刪除]  。 若要編輯協調流程群組，請選取協調流程群組，然後按一下功能區或右鍵功能表中的 [屬性]  。 變更下列索引標籤中的設定：

   - **一般**： 
      - **名稱**：協調流程群組的名稱
      - **描述**：協調流程群組描述 (選擇性)
      - [Orchestration Group timeout (in minutes] \()協調流程群組逾時 (分鐘)\)  ：所有群組成員完成更新安裝的時間限制。
      - **協調流程群組成員逾時 (分鐘)** ：群組中單一裝置完成更新安裝的時間限制。

  - [成員選取]  ：
     - **站台碼**：協調流程群組的站台碼。
     - **成員**：按一下 [新增]  為協調流程群組選取其他裝置。 按一下 [移除]  來移除選取的裝置。

   - [規則選取]  ：
      - [允許同時更新一部分的電腦]  ，然後選取或輸入此百分比的數字。 使用此設定來允許未來彈性的協調流程群組大小。 例如，您的協調流程群組包含 50 部裝置，而且您將此值設定為 10。 在軟體更新部署期間，Configuration Manager 允許五部裝置同時執行部署。 若您稍後將協調流程群組大小新增為 100 部裝置，則一次可更新 10 部裝置。
      - [允許同時更新多部電腦]  ，然後選取或輸入此特定計數的數字。 使用此設定來一律限制特定裝置數目，不論協調流程群組整體大小為何。
      - **指定維護順序**：將選取的資源排序為適當順序。 使用此設定來明確定義裝置執行軟體更新部署的特定順序。

   - [更新前指令碼]  ： 
       - 輸入執行部署「前」  要在每部裝置上執行的 PowerShell 指令碼。 該指令碼會傳回 `0` (代表成功) 或 `3010` (成功但需要重新啟動)。
       
   - [更新後指令碼]  ：
      - 輸入執行部署「後」  要在每部裝置上執行的 PowerShell 指令碼。 該指令碼會傳回 `0` (代表成功) 或 `3010` (成功但需要重新啟動)。
   > [!WARNING]
   > 請先確定更新前指令碼和更新後指令碼已經過測試，再將其用於協調流程群組。 更新前指令碼和更新後指令碼不會逾時，而是會一直執行到協調流程群組成員逾時為止。


## <a name="start-orchestration"></a>啟動協調流程

1. [部署軟體更新](deploy-software-updates.md)至包含協調流程群組成員的集合。

1. 協調流程會在群組中的任何用戶端嘗試在期限之前或維護時段期間安裝任何軟體更新時開始。 它會針對整個群組開始，並確定裝置依下列協調流程群組規則更新。
1. 您可以從 [協調流程群組]  節點選取協調流程，然後從功能區或右鍵功能表中選擇 [啟動協調流程]  來手動加以啟動。
1. 如果協調流程群組處於「失敗」  狀態：
   1. 判斷協調流程失敗的原因，並解決任何問題。
   1. [重設群組成員的協調流程狀態](#bkmk_reset)。
   1. 從 [協調流程群組]  節點，按一下 [啟動協調流程]  按鈕，以重新啟動協調流程。
    使用 [啟動協調流程]  按鈕來重設該狀態。  
   [![啟動協調流程 ](./media/3098816-start-orchestration.png)](./media/3098816-start-orchestration.png#lightbox)


> [!TIP]
> - 協調流程群組只會套用到軟體更新部署。 它們不會套用到其他部署。
> - 您能以滑鼠右鍵按一下協調流程群組成員，然後選取 [重設協調流程群組成員]  。 這可讓您重新執行協調流程。


## <a name="monitor-orchestration-groups"></a><a name="bkmk_orch_monitor"></a> 監視協調流程群組

從 [資產與合規性]  工作區，選取 [協調流程群組]  節點。 新增下列任何任一欄以取得群組的相關資訊：

- **協調流程名稱**：您協調流程群組的名稱。
- **站台碼**：群組的站台碼。
- **協調流程類型**：是下列其中一種類型：
   - 數字
   - 百分比
   - 順序

- **協調流程值**：有多少個成員或多少百分比的成員會同時取得鎖定。 [協調流程值]  只會在 [協調流程類型]  為 [數字]  或 [百分比]  的情況下填入。  
- **協調流程狀態**：在協調流程期間為 [進行中]。 未進行時為 [閒置]。
- **協調流程開始時間**：協調流程開始的日期和時間。
- **目前的序號**：指出群組協調流程中的哪個成員為作用中。 此數字會與該成員的 [序號]  對應。  
- **協調流程逾時 (分鐘)** ：在建立群組時於 [一般]  頁面上，或是在編輯群組時於 [一般]  索引標籤上設定的 [協調流程群組逾時 (分鐘)]  值。
- **協調流程群組成員逾時 (分鐘)** ：在建立群組時於 [一般]  頁面上，或是在編輯群組時於 [一般]  索引標籤上設定的 [協調流程群組成員逾時 (分鐘)]  值。
- **協調流程群組識別碼**：群組的識別碼；識別碼會用於記錄檔與資料庫。
- **協調流程群組唯一識別碼**：群組的唯一識別碼；唯一識別碼會用於記錄檔與資料庫。

## <a name="monitor-orchestration-group-members"></a>監視協調流程群組成員

在 [協調流程群組]  節點上，選取協調流程群組。 在功能區中，選取 [顯示成員]  。 您可以查看群組的成員，以及其協調流程狀態。 新增下列任一欄以取得成員的相關資訊：

- **名稱**：協調流程群組成員的裝置名稱
- **目前狀態**：為您提供成員裝置的狀態。
   - 在協調流程期間為 [進行中]  。
   - **等待中**：指出用戶端正在等候鎖定結束並輪到其安裝更新。
   - 在協調流程已完成或未執行時為 [閒置]  。
- **狀態碼**：您能以滑鼠右鍵按一下協調流程群組成員，然後選取 [重設協調流程群組成員]  。 此重設可讓您重新執行協調流程。 狀態包括： 
   - 閒置
   - 等候中，裝置目前正在等候
   - 進行中，正在安裝更新
   - Failed
   - 重新開機擱置中
- **鎖定取得的時間**：用戶端會根據其原則要求鎖定。 當用戶端取得鎖定時，協調流程便會在其上觸發。  
-**上次狀態回報時間**：成員上次回報狀態的時間。
- **序號**：用戶端在安裝更新之佇列中的位置。
- **站台碼**：成員的站台碼。
- **用戶端活動**：告訴您用戶端為作用中或非作用中。
- **主要使用者**：哪些使用者為裝置的主要使用者。
- **用戶端類型**：用戶端為哪種類型的裝置。
- **目前登入的使用者**：目前已登入裝置的使用者為何。
- **OG 識別碼**：成員所屬協調流程群組的識別碼。
- **OG 唯一識別碼**：成員所屬協調流程群組的唯一識別碼。
- **資源識別碼**：裝置的資源識別碼。

## <a name="reset-the-orchestration-state-for-a-group-member"></a><a name="bkmk_reset"></a> 重設群組成員的協調流程狀態

如果想要在群組成員上重新執行協調流程，則可清除其狀態，例如「完成」  或「失敗」  。 若要清除狀態，請以滑鼠右鍵按一下協調流程群組成員，然後選取 [Reset Orchestration Group Member] \(重設協調流程群組成員\)  。 您也可以從功能區中按一下 [重設協調流程群組成員]  。 在重設狀態之前，應該檢查用戶端以查看失敗的原因，並更正任何發現的問題。
   [![重設協調流程群組成員](./media/3098816-reset-group-member.png)](./media/3098816-reset-group-member.png#lightbox)

## <a name="log-files"></a>記錄檔

使用站台伺服器上的下列記錄檔來協助間監視及疑難排解：

### <a name="site-server"></a>網站伺服器

- **Policypv.log**：顯示站台將協調流程群組的目標設定為用戶端。
- **SMS_OrchestrationGroup.log**：顯示協調流程群組的行為。

### <a name="client"></a>用戶端

- **MaintenanceCoordinator.log**：顯示鎖定取得、更新安裝、更新前和更新後指令碼，以及鎖定釋放程序。
- **UpdateDeployment.log**：顯示更新安裝程序。
- **PolicyAgent.log**：檢查用戶端是否位於協調流程群組。

## <a name="next-steps"></a>後續步驟

[部署軟體更新](deploy-software-updates.md)