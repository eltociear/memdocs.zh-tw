---
title: 自動部署軟體更新
titleSuffix: Configuration Manager
description: 使用自動部署規則 (ADR) 來自動部署軟體更新。
author: mestew
ms.author: mstewart
manager: dougeby
ms.date: 05/11/2020
ms.topic: conceptual
ms.prod: configuration-manager
ms.technology: configmgr-sum
ms.assetid: b27682de-adf8-4edd-9572-54886af8f7fb
ms.openlocfilehash: d1b4329def3aee97e1684935c0c8f889c3e4e513
ms.sourcegitcommit: fddbb6c20cf7e19944944d4f81788adf249c963f
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/12/2020
ms.locfileid: "83269026"
---
#  <a name="automatically-deploy-software-updates"></a>自動部署軟體更新  

適用於：Configuration Manager (最新分支)

使用自動部署規則 (ADR)，而不為現有的軟體更新群組新增更新。 一般而言，您會使用 ADR 來部署每月軟體更新 (也稱為「週二修補程式日」更新) 以及管理 Endpoint Protection 定義更新。 如果需要協助來判斷哪種部署方法最適合您，請參閱 [Deploy software updates](deploy-software-updates.md) (部署軟體更新)。


##  <a name="create-an-automatic-deployment-rule-adr"></a><a name="BKMK_CreateAutomaticDeploymentRule"></a> 建立自動部署規則 (ADR)  
使用 ADR 來自動核准並部署軟體更新。 每次執行規則或在現有群組中新增軟體更新時，此規則都可以在新的軟體更新群組中新增軟體更新。 在執行規則並將軟體更新新增至現有群組時，此規則會從群組中移除所有更新。 接著，它會將符合您定義之準則的更新新增至群組。 

> [!WARNING]  
>  第一次建立 ADR 之前，請驗證該站台已完成軟體更新同步處理。 在您執行非英文版本的 Configuration Manager 時，這個步驟很重要。 進行首次同步處理前，會以英文顯示軟體更新分類。軟體更新同步處理完成後，則會以本地化語言顯示。 進行同步處理軟體更新前建立的規則，在同步處理後可能無法正確運作，因為文字字串可能會不相符。  


### <a name="process-to-create-an-adr"></a><a name="bkmk_adr-process"></a> 建立 ADR 的程序  

1.  在 Configuration Manager 主控台中，移至 [軟體程式庫] 工作區、展開 [軟體更新]，然後選取 [自動部署規則] 節點。  

2.  在功能區中，按一下 [建立自動部署規則]。  

3.  在 [建立自動部署規則精靈] 的 [一般] 頁面上，指定下列設定：  

    -   **名稱**：指定 ADR 的名稱。 名稱必須是唯一的，且能協助描述規則目的，並能在 Configuration Manager 站台上從其他名稱中輕易找出。  

    -   **描述**：指定 ADR 的描述。 此描述應提供部署規則的概觀，以及其他有助於區分該規則與其他規則的相關資訊。 描述欄位是選用欄位，長度限制為 256 字元，預設為空白值。  

    -   **範本**：選取部署範本，以指定是否要套用先前儲存的 ADR 設定。 設定一個部署範本，其中包含多個可在建立其他 ADR 時使用的常見更新部署內容。 這些範本可節省時間，並協助確保類似部署的一致性。 選取下列其中一個內建的軟體更新部署範本：  

         - [周二修補]  範本提供每月部署軟體更新時使用的一般設定。  

         - [Office 365 用戶端更新] 範本提供在部署 Office 365 Pro Plus 用戶端的更新時所要使用的一般設定。
             > [!Note]
             > 從 2020 年 4 月 21 日開始，「Office 365 專業增強版」會重新命名為「Microsoft 365 Apps 企業版」。 如果您的 ADR 依賴 [標題] 屬性，您就必須從 2020 年 6 月 9 日開始編輯該屬性。 `Microsoft 365 Apps Update - Semi-annual Channel Version 1908 for x64 based Edition (Build 11929.50000)` 是新標題的一個範例。 如需詳細資訊，請參閱 [Office 365 專業增強版的名稱變更](https://docs.microsoft.com/deployoffice/name-change) \(部分機器翻譯\)。

         - [SCEP 與 Windows Defender 防毒軟體更新] 範本提供在部署 Endpoint Protection 定義更新時所要使用的一般設定。  

    -   **集合**：指定針對部署所使用的目標集合。 集合內的成員會收到部署中定義的軟體更新。  

    -   決定要將軟體更新新增至新的或現有軟體更新群組。 在大多數情況下，執行 ADR 時，請選擇建立新的軟體更新群組。 如果以更頻繁的排程執行規則，您應選擇使用現有群組。 例如，若您每天執行定義更新的規則，則可以將軟體更新新增至某個現有的軟體更新群組。  

    -   **在執行此規則後啟用部署**：指定執行 ADR 後，是否要啟用軟體更新部署。 針對此設定，請考慮這項設定的下列選項：  

        -   當您啟用此部署時，系統會將符合規則已定義準則的更新新增至軟體更新群組中。 將會視需要下載軟體更新內容。 此內容會複製到指定的發佈點，而更新則會部署至目標集合內的用戶端。  

        -   當您未啟用此部署時，系統會將符合規則已定義準則的更新新增至軟體更新群組中。 軟體更新部署內容會視需要進行下載，並散發到指定的發佈點。 站台會在軟體更新群組上建立已停用的部署，以避免將更新部署至用戶端。 此選項可提供時間來準備部署更新、確認符合準則的更新是適當的，然後啟用部署。  

4.  在 [部署設定]　頁面上，指定下列設定：  

    -   **使用 [網路喚醒] 來喚醒用戶端進行必要的部署**：指定是否於期限啟用網路喚醒。 網路喚醒將喚醒封包 (該封包於部署中需要一或多個軟體更新) 傳送到某部電腦上。 站台會喚醒任何在安裝期限處於睡眠模式的電腦，以便起始安裝。 在部署中處於睡眠狀態且不需要任何軟體更新的用戶端並不會啟動。 根據預設不會啟用此設定。 使用此選項之前，請先針對 [網路喚醒] 設定電腦和網路。 如需詳細資訊，請參閱[如何設定網路喚醒](../../core/clients/deploy/configure-wake-on-lan.md)。  

    -   **詳細等級**：針對由用戶端報告的強制更新狀態訊息，指定詳細資料等級。  

        > [!IMPORTANT]  
        >  部署定義更新時，請將詳細等級設定為 [僅錯誤] ，讓用戶端僅在定義更新失敗時才回報狀態訊息。 否則，用戶端會回報一大批的狀態訊息，可能影響到站台伺服器效能。  
        
        > [!NOTE]  
        > [僅錯誤] 詳細等級不會傳送追蹤擱置重新開機所需的強制執行狀態訊息。

    -   **授權條款設定**：指定是否搭配相關聯授權條款，自動部署軟體更新。 某些軟體更新會包含授權條款。 自動部署軟體更新時，不會顯示授權條款，也沒有接受授權條款的選項。 請選擇不論相關聯的授權條款為何，皆自動部署所有軟體更新，或是只部署沒有相關聯授權條款的更新。  

         - 若要檢閱軟體更新的授權條款，請在 [軟體程式庫] 工作區的 [所有軟體更新] 節點中選取軟體更新。 在功能區中，按一下 [檢閱授權]。    

         - 若要尋找具有相關聯授權條款的軟體更新，請在 [所有軟體更新] 節點的 [結果] 窗格中新增 [授權條款] 資料行。 按一下該欄的標頭，即可依具有授權條款的軟體更新進行排序。  

5.  在 [軟體更新] 頁面上，為 ADR 所擷取並新增至軟體更新群組的軟體更新設定準則。  

     - ADR 中軟體更新的限制為 1000 個軟體更新。  

     - 必要的話，請在自動部署規則中依軟體更新的內容大小進行篩選。 如需詳細資訊，請參閱 [Configuration Manager and simplified Windows servicing on down level operating systems](https://techcommunity.microsoft.com/t5/configuration-manager-archive/configuration-manager-and-simplified-windows-servicing-on-down/ba-p/274056) (下層作業系統上的 Configuration Manager 及簡化的 Windows 服務)。  

     - 從 1910 版開始，您可以使用 [已部署] 作為自動部署規則的更新篩選條件。 此篩選器可協助識別可能需要部署至試驗或測試集合的新更新。 軟體更新篩選器也可協助避免重新部署較舊的更新。 
         - 使用 [已部署] 作為篩選器時，請注意您可能已經將更新部署至另一個集合，例如試驗或測試集合。 <!--4852033-->
     - 從 1806 版開始，**架構**的內容篩選現已可供使用。 請使用此篩選來排除 Itanium 及 ARM64 等較不常見的架構。 請記住，64 位元 (x64) 系統上有執行 32 位元 (x86) 應用程式和元件。 除非您確定已不再需要 x86，否則請在選擇 [x64] 時一起啟用 [x86]。<!--1322266-->  

    > [!NOTE]  
    > **Windows 10 1903 版和更新版本**已作為其專屬產品新增至 Microsoft Update，而不是像舊版一樣作為 **Windows 10** 產品的一部分。 此變更導致您需要執行一些手動步驟以確保您的用戶端可看到這些更新。 我們已協助減少您必須為 Configuration Manager 1906 版新產品進行的手動步驟數量。 如需詳細資訊，請參閱[設定 Windows 10 各版本的產品](../get-started/configure-classifications-and-products.md#windows-10-version-1903-and-later) <!--4682946-->


6. 在 [評估排程] 頁面上，指定是否要啟用 ADR 使其按照排程執行。 啟用時，按一下 [自訂]  設定週期性排程。  

    - 排程的開始時間設定是以執行 Configuration Manager 主控台之電腦的本機時間為根據。  

    - ADR 評估一天最多可執行 3 次。  

    - 切勿將評估排程的頻率設定為超過軟體更新同步處理排程。 此頁面會顯示軟體更新點同步處理排程，以協助您決定評估排程頻率。  

    - 若要手動執行 ADR，請在主控台的 [自動部署規則] 節點中選取規則，然後按一下功能區中的 [立即執行]。  

    - 從 1802 版開始，可以排定讓 ADR 在與基準日有時間差的情況下進行評估。 比方說，如果您的「週二修補程式日」實際上是在星期三，則可以將該月第二個星期二的評估排程設定為有一天時間差。<!--1357133-->  
        - 搭配時間差將評估排定在月份最後一週時，如果所選擇的時間差會跨到下個月，站台就會將評估排定在當月最後一天執行。<!--506731-->  
        ![與基準日有時間差的 ADR 自訂評估排程](./media/ADR-evaluation-schedule-offset.PNG)

   
7.  在 [部署排程] 頁面上，指定下列設定：  

    -   **為評估排程**：指定 Configuration Manager 對可用時間及安裝期限進行評估的時間。 選擇使用國際標準時間 (UTC) 或執行 Configuration Manager 主控台之電腦的本機時間。  

          - 當您在此處選取 [用戶端本機時間]，然後針對 [軟體可用時間] 選取 [盡快] 時，就會使用執行 Configuration Manager 主控台之電腦上的目前時間，來評估更新可用的時間。 此行為與 [安裝期限] 和用戶端上安裝更新的時間相同。 如果用戶端位於不同時區，則會在用戶端的時間達到評估時間時，執行這些動作。  

    -   **軟體可用時間**：選取以下其中一種設定來指定用戶端何時可以使用軟體更新：  

        -   **盡快**：可讓用戶端在最短時間內使用部署中的軟體更新。 利用選取的設定建立部署時，Configuration Manager 會更新用戶端原則。 在下一個用戶端原則輪詢循環中，用戶端將會察覺該部署且軟體更新可供安裝。  

        -   **特定時間**：在特定的日期和時間將包含在部署中的軟體更新提供給用戶端。 建立部署時啟用此設定，Configuration Manager 會更新用戶端原則。 在下一個用戶端原則輪詢循環中，用戶端將會察覺該部署。 不過，在設定的日期和時間之前，無法使用部署中的軟體更新進行安裝。  

    -   **安裝期限**：選取下列其中一個設定，以指定部署中軟體更新的安裝期限：  

        -   **盡快**：選取此設定，以自動在最短時間內安裝部署中的軟體更新。  

        -   **特定時間**：選取此設定，以在特定日期和時間自動安裝部署中的軟體更新。 將已設定的 [特定時間] 間隔新增到 [軟體可用時間]，Configuration Manager 藉此判斷安裝軟體更新的期限。  

             - 實際安裝期限時間是顯示的期限時間再加上最多 2 小時的隨機時間量。 此隨機設定可降低集合中用戶端同時安裝部署中更新可能造成的影響。  

             - 若要針對必要的軟體更新停用安裝隨機延遲，請設定 [電腦代理程式] 群組中 [停用期限隨機設定] 的用戶端設定。 如需詳細資訊，請參閱[電腦代理程式用戶端設定](../../core/clients/deploy/about-client-settings.md#computer-agent)。  

    -  **根據使用者喜好延遲實行此部署，最多延後至用戶端設定中定義的寬限期**：啟用此設定可提供使用者更多時間，讓他們在期限過後安裝必要軟體更新。  

        - 當電腦已長時間關閉，而需要安裝大量軟體更新或應用程式時，通常就需要允許此行為。 例如，當使用者從假期歸來時，他們必須等候很長的時間，讓用戶端安裝逾期的部署。  

        - 使用用戶端設定中的 [延後到部署期限後施行的寬限期 (小時)] 內容來設定此寬限期。 如需詳細資訊，請參閱[電腦代理程式](../../core/clients/deploy/about-client-settings.md#computer-agent)一節。 已啟用此選項且以您一併部署用戶端設定之裝置為目標的所有部署，都適用此施行寬限期。  

        - 期限之後，用戶端就會在使用者所設定的第一個非營業時間內安裝此軟體更新，直到該寬限期結束為止。 不過，使用者仍可隨時開啟軟體中心並安裝軟體更新。 過了寬限期後，就會強制還原為逾時部署的標準行為。  

8. 在 [使用者體驗] 頁面上，指定下列設定：  

    -   **使用者通知**：指定是否要在設定的**軟體可用時間**，於軟體中心內顯示通知。 此設定也會控制是否要在用戶端上通知使用者。  

    -   **期限行為**：當軟體更新部署達到任何定義之維護期間以外的期限時，此設定會指定相關行為。 這些選項包括是否要安裝軟體更新，以及是否要在安裝後執行系統重新啟動。 如需維護期間的詳細資訊，請參閱[如何在 Configuration Manager 中使用維護期間](../../core/clients/manage/collections/use-maintenance-windows.md)。  
        
        > [!Note]
        > 只有在為用戶端裝置設定了維護時段時，才適用此選項。 如果未在裝置上定義任何維護時段，則一律會在期限後進行安裝更新和重新啟動。

    -   **裝置重新啟動行為**：指定當必須重新啟動才能完成更新安裝時，是否要抑制伺服器和工作站上的系統重新啟動。  

        > [!WARNING]  
        >  在伺服器環境中，或當您不想在預設情況下重新啟動目標電腦時，抑制系統重新啟動很有用。 不過，這麼做會讓電腦處於不安全的狀態。 允許強制重新啟動可協助您確保立即完成軟體更新安裝。  

    -   **Windows Embedded 裝置的寫入篩選處理**：這項設定會在具備寫入篩選功能的 Windows Embedded 裝置上控制安裝行為。 選擇在安裝期限或維護期間認可變更的選項。 當您選取此選項時，需要重新啟動裝置才能保存裝置的變更。 否則會將更新安裝、套用至暫存重疊，並於稍後認可。  

           -  當您將軟體更新部署至 Windows Enbedded 裝置時，請確定裝置是已設定維護期間之集合的成員。  

    - **重新啟動時的軟體更新部署重新評估行為**：選取此設定，就會將軟體更新部署設定成在用戶端安裝軟體更新並重新啟動之後，讓用戶端立即執行軟體更新相容性掃描。 此設定可讓用戶端檢查是否有在用戶端重新啟動後變成適用的額外更新，然後在同一個維護期間內安裝這些更新。  

9. 在 [警示] 頁面上，設定 Configuration Manager 如何針對此部署產生警示。 透過 [軟體程式庫] 工作區之 [軟體更新] 節點中的 Configuration Manager，檢閱最新的軟體更新警示。 如果您同時使用 System Center Operations Manager，也請設定其警示。  

10. 在 [下載設定] 頁面上，指定下列設定：  

    - 指定當用戶端使用鄰近或預設站台界限群組中的發佈點時，是否應該下載並安裝更新。  

    - 指定當目前或鄰近界限群組中的發佈點沒有軟體更新內容可用時，用戶端是否應該從站台預設界限群組中的發佈點下載並安裝更新。  

    - **允許用戶端與同一個子網路上的其他用戶端共用內容**：指定是否要針對內容下載啟用使用 BranchCache。 如需詳細資訊，請參閱 [BranchCache](../../core/plan-design/hierarchy/fundamental-concepts-for-content-management.md#branchcache)。 從 1802 版開始，用戶端上一律會啟用 BranchCache。 此設定已移除，因為用戶端會使用 BranchCache (如果發佈點支援)。  

    - **如果在目前、鄰近或站台界限群組的發佈點上找不到軟體更新，則從 Microsoft Update 下載內容**：選取這項設定的話，如果在發佈點上找不到更新，就會讓連線到內部網路的用戶端從 Microsoft Update 下載軟體更新。 以網際網路為基礎的用戶端隨時可移至 Microsoft Update 取得軟體更新內容。  

    - 指定當用戶端使用計量付費網際網路連線時，是否在過了安裝期限後仍允許用戶端進行下載。 在您處於計量付費連線時，網際網路提供者有時會根據您傳送和接收的資料量來收取費用。  

    > [!NOTE]  
    >  用戶端會從部署內軟體更新的管理點來請求內容位置。 下載行為會根據您如何設定發佈點、部署套件和本頁設定而定。   

11. 在 [部署套件] 頁面上，選取下列其中一個選項：  

    - **選取部署套件**：將這些更新新增至現有的部署套件。  

    - **建立新的部署套件**：將這些更新新增至新的部署套件。 指定下列其他設定：  

        -  **名稱**：指定部署套件的名稱。 請使用一個描述套件內容的唯一名稱。 長度限制為 50 個字元。  

        -  **描述**：指定描述，提供有關部署套件的資訊。 選擇性描述限制為 127 個字元。  

        -  **套件來源**：指定軟體更新來源檔案的位置。 鍵入來源位置的網路路徑 (例如 `\\server\sharename\path`)，或按一下 [瀏覽] 尋找網路位置。 請先建立部署套件來源檔案的共用資料夾，再繼續前往下一個頁面。  

            - 您無法使用指定的位置作為另一個軟體部署套件的來源。  

            - 您可以在 Configuration Manager 建立部署套件之後，變更部署套件內容中的套件來源位置。 如果您這樣做，就需先將內容從原始套件來源複製到新的套件來源位置。  

            -  SMS 提供者電腦帳戶和執行精靈下載軟體更新的使用者，都必須具有下載位置的**寫入**權限。 限制存取下載位置。 這項限制可降低攻擊者竄改軟體更新來源檔案的風險。  

        -  **傳送優先順序**：指定部署封裝的傳送優先順序。 Configuration Manager 將套件傳送到發佈點時，會使用此優先順序。 部署套件會依優先順序傳送：高、中或低。 優先順序相同的套件，會依照建立的順序傳送。 若沒有待處理項目，則無論套件的優先順序為何，系統都會立即處理它。  

        - **啟用二進位差異複寫**：啟用此設定可將網站之間的網路流量降到最低。 二進位差異複寫 (BDR) 只會更新套件中已變更的內容，而不是更新整個套件內容。 如需詳細資訊，請參閱[二進位差異複寫](../../core/plan-design/hierarchy/fundamental-concepts-for-content-management.md#binary-differential-replication)。  

    - **無部署套件**：從 1806 版開始，不必先下載內容並將其發佈至發佈點，就可以將軟體更新部署至裝置。 處理極大量更新內容時，這項設定很有幫助。 一律要讓用戶端從 Microsoft Update 的雲端服務取得內容時，也請使用它。 此案例中的用戶端也可以從已具有必要內容的對等節點下載內容。 Configuration Manager 用戶端會繼續管理內容的下載，因此可以利用 Configuration Manager 的對等快取功能或其他技術，例如傳遞最佳化。 這項功能支援 Configuration Manager 軟體更新管理所支援的任何更新類型，包括 Windows 和 Office 更新。<!--1357933-->  

        > [!Note]  
        > 一旦您選取此選項並套用設定之後，就無法再變更它。 其他選項均呈現灰色。<!--SCCMDocs-pr issue 3003-->  

12. 在 [發佈點] 頁面上，指定將裝載軟體更新檔案的發佈點或發佈點群組。 如需發佈點的詳細資訊，請參閱[發佈點設定](../../core/servers/deploy/configure/install-and-configure-distribution-points.md#bkmk_configs)。 此頁面只有在您建立新的軟體更新部署套件時才可使用。  
  

13. 在 [下載位置] 頁面上，指定要從網際網路或您的區域網路下載軟體更新檔案。 進行以下設定：  

    -   **從網際網路下載軟體更新**：選取此設定可從網際網路上的指定位置下載軟體更新。 預設會啟用此設定。  

    -   **從本機網路上的位置下載軟體更新**：選取此設定會從本機目錄或共用資料夾下載軟體更新。 此設定在執行精靈的電腦沒有網際網路存取時很實用。 任何具有網際網路存取的電腦都可以預先下載軟體更新。 然後，將它們儲存在本機網路上執行精靈的電腦可存取的位置。 另一種情況可能是下載透過 System Center Updates Publisher 或協力廠商修補解決方案發佈的內容時。 頂層軟體更新點上的 WSUS 內容共用可以輸入為要從中下載的網路位置，例如 `\\server\WsusContent`。 <!--memdocs-issue-211-->

14. 在 [語言選擇] 頁面上，選取站台下載已選取之軟體更新所使用的語言。 只有在軟體更新有提供所選取的語言時，站台才會進行下載。 無指定語言的軟體更新一律會下載。 根據預設，精靈會選取您在軟體更新點內容中設定的語言。 您必須至少選取一種語言才能繼續至下一頁。 如果您只選取軟體更新不支援的語言，則更新下載會失敗。  

15. 在 [摘要]  頁面上，檢閱設定。 若要將設定儲存至部署範本，請按一下 [儲存成範本]。 輸入名稱並選取要包含在範本中的設定，然後按一下 [儲存]。 若要變更已經設定的設定，請按一下相關聯的精靈頁面，然後變更設定。  

    -  範本名稱可以包含英數字 ASCII 字元以及 `\` (反斜線) 或 `'` (單引號)。  

16. 按一下 [下一步]  以建立 ADR。  

完成精靈後，ADR 就會執行。 它會將符合指定準則的軟體更新新增至軟體更新群組。 然後，ADR 會將更新下載至站台伺服器上的內容庫，然後將它們發佈至所設定的發佈點。 ADR 接著會將軟體更新群組部署至目標集合中的用戶端。  



##  <a name="add-a-new-deployment-to-an-existing-adr"></a><a name="BKMK_AddDeploymentToADR"></a> 將新的部署新增至現有的 ADR  

建立 ADR 之後，請將其他部署新增至規則中。 此動作可協助您管理將不同更新部署到不同集合的複雜性。 每個新部署都會有完整的功能和部署監視體驗。  


### <a name="process-to-add-a-new-deployment-to-an-existing-adr"></a>將新部署新增至現有 ADR 的程序  

1.  在 Configuration Manager 主控台中，移至 [軟體程式庫] 工作區、展開 [軟體更新]、選取 [自動部署規則] 節點，然後選取所需的規則。  

2.  在功能區中，按一下 [新增部署]。   

3.  在 [新增部署精靈] 的 [集合] 頁面上，設定與 [建立自動部署規則精靈] 之 [一般] 頁面類似的可用設定。 如需詳細資訊，請參閱上一節：[建立 ADR 的程序](#bkmk_adr-process)。 [新增部署精靈] 的其餘部分包含也符合上述詳細描述的下列頁面：  

     - 部署設定
     - 部署排程
     - 使用者體驗
     - 警示
     - 下載設定  

部署也可以使用 Windows PowerShell Cmdlet 以程式設計方式新增。 如需使用此方法的完整說明，請參閱 [New-CMSoftwareUpdateDeployment](https://docs.microsoft.com/powershell/module/configurationmanager/new-cmsoftwareupdatedeployment) \(英文\)。

如需部署程序的詳細資訊，請參閱 [Software update deployment process](../understand/software-updates-introduction.md#BKMK_DeploymentProcess)。


## <a name="next-steps"></a>後續步驟
[監視軟體更新](monitor-software-updates.md)
