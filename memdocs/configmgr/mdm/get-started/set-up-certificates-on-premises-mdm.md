---
title: 內部部署 MDM 的憑證
titleSuffix: Configuration Manager
description: 在 Configuration Manager 中，設定與內部部署行動裝置管理（MDM）進行信任通訊的憑證。
ms.date: 01/09/2020
ms.prod: configuration-manager
ms.technology: configmgr-mdm
ms.topic: conceptual
ms.assetid: 2a7d7170-1933-40e9-96d6-74a6eb7278e2
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: bc63a21970bb522407c86d027690b83894b3cb99
ms.sourcegitcommit: 578ad1e8088f7065b565e8a4f4619f5a26b94001
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/21/2020
ms.locfileid: "81724662"
---
# <a name="set-up-certificates-for-trusted-communications-with-on-premises-mdm"></a>設定憑證以與內部部署 MDM 進行受信任的通訊

適用於：  Configuration Manager (最新分支)

Configuration Manager 內部部署行動裝置管理（MDM）會要求您設定網站系統角色，以便與受管理的裝置進行受信任的通訊。 您需要兩種類型的憑證：

- 在裝載必要網站系統角色的伺服器上，IIS 中的**web 伺服器憑證**。 如果一部伺服器裝載多個網站系統角色，則該伺服器只需要一個憑證。 如果每個角色都在不同的伺服器上，則每一部伺服器都需要個別的憑證。

- 發行 web 伺服器憑證之憑證授權單位單位（CA）的**受信任根憑證**。 在所有需要連線到網站系統角色的裝置上安裝此根憑證。

針對已加入網域的裝置，如果您使用 Active Directory 憑證服務，它可以在所有裝置上自動安裝這些憑證。 對於未加入網域的裝置，請以其他方式安裝受信任的根憑證。

對於大量註冊的裝置，您可以在註冊套件中包含憑證。 對於使用者註冊的裝置，您則需要透過電子郵件、Web 下載或某種其他方法來新增憑證。

如果您使用知名公用 CA （例如 Verisign 或 GoDaddy）來發行伺服器憑證，您可以避免在每個裝置上手動安裝受信任的根憑證。 大部分的裝置原本就信任這些公用授權單位。 這個方法是使用者註冊裝置的實用替代方案，而不是透過其他方式安裝憑證。

> [!IMPORTANT]  
> 有許多方式可設定裝置與內部部署 MDM 網站系統伺服器之間受信任通訊的憑證。 本文中的資訊是其中一種方法的範例。 此方法需要 Active Directory 憑證服務，以及憑證授權單位單位和憑證授權單位單位網頁註冊角色。 如需詳細資訊，請參閱[Active Directory 憑證服務](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831740\(v=ws.11\))。

## <a name="publish-the-crl"></a><a name="bkmk_configCa"></a>發行 CRL

根據預設，Active Directory 憑證授權單位單位（CA）會使用以 LDAP 為基礎的憑證撤銷清單（Crl）。 它允許與已加入網域之裝置的 CRL 連接。 若要讓未加入網域的裝置信任 CA 所簽發的憑證，請新增以 HTTP 為基礎的 CRL。

1. 在執行您網站憑證授權單位單位的伺服器上，移至 [**開始**] 功能表，選取 [系統**管理工具**]，然後選擇 [**憑證授權單位**單位]。

1. 在 [憑證授權單位單位] 主控台中，以滑鼠右鍵按一下 [ **CertificateAuthority**]，然後選取 [**屬性**]。

1. 在 [CertificateAuthority 內容] 中，切換至 [**擴充**功能] 索引標籤。請確定 [**選取延伸**] 是設定為 **[CRL 發佈點（CDP）**]。

1. 選取 `http://<ServerDNSName>/CertEnroll/<CAName><CRLNameSuffix><DeltaCRLAllowed>.crl`。 然後選取下列選項：

    - **包含在 Crl 中。用戶端會使用此來尋找 Delta CRL 位置。**

    - **包含在已發行憑證的 CDP 延伸中。**

    - **包含在已發行 CRL 的 IDP 延伸中**

1. 切換至 [結束**模組**] 索引標籤。選取 [**屬性**]，然後選取 [**允許憑證發行至檔案系統**]。 您會看到重新開機 Active Directory 憑證服務的通知。

1. 以滑鼠右鍵按一下 [**撤銷的憑證**]，選取 [**所有**工作]，然後選擇 [**發佈**]。

1. 在 [發行 CRL] 視窗中，選取 [**僅限 DELTA crl**]，然後選取 **[確定**] 以關閉視窗。

## <a name="create-the-certificate-template"></a><a name="bkmk_certTempl"></a>建立憑證範本

CA 會使用 web 伺服器憑證範本來頒發證書給裝載網站系統角色的伺服器。 這些伺服器將會是網站系統角色與已註冊裝置之間受信任通訊的 SSL 端點。

1. 建立名為**CONFIGMGR MDM servers**的網域安全性群組。 將網站系統伺服器的電腦帳戶新增至群組。

1. 在 [憑證授權單位單位] 主控台中，以滑鼠右鍵按一下 [**憑證範本**]，然後選擇 [**管理**]。 此動作會載入 [憑證範本] 主控台。

1. 在 [結果] 窗格中，以滑鼠右鍵按一下 [**範本顯示名稱**] 欄中顯示 [ **Web 服務器**] 的專案，然後選取 [**複製範本**]。

1. 在 [**複製範本**] 視窗中，選取 [ **Windows 2003 Server，enterprise Edition** ] 或 [ **Windows 2008 Server，enterprise Edition**]，然後選取 **[確定]**。

    > [!TIP]
    > Configuration Manager 支援 Windows 2008 伺服器憑證範本，也稱為 V3 或密碼編譯：新一代（CNG）憑證。 如需詳細資訊，請參閱 [CNG 憑證概觀](../../core/plan-design/network/cng-certificates-overview.md)。

    如果您的 CA 在 Windows Server 2012 或更新版本上執行，此視窗不會顯示憑證範本版本的選項。 複製範本之後，請在範本屬性的 [**相容性**] 索引標籤上選取版本。

1. 在 [**新範本**的內容] 視窗的 [**一般**] 索引標籤上，輸入範本名稱。 CA 會使用此名稱來產生將在 Configuration Manager 網站系統上使用的 web 憑證。 例如，輸入**CONFIGMGR MDM web 伺服器**。

1. 切換至 [**主體名稱**] 索引標籤，然後**從 [Active Directory 資訊**] 選取 [組建]。 針對 [主體名稱格式]，指定 [ **DNS 名稱**]。 如果已選取 **[使用者主體名稱（UPN）** ]，請停用 [替代主體名稱] 選項。

1. 切換至 [**安全性**] 索引標籤。

    1. 從**Domain admins**和**Enterprise Admins**安全性群組中移除 [**註冊**] 許可權。

    1. 選取 [**新增**]，然後輸入您的安全性群組名稱。 例如， **CONFIGMGR MDM 伺服器**。 選取 **[確定**] 以關閉視窗。

    1. 選取此群組的 [**註冊**] 許可權。 請勿移除**讀取**許可權。

1. 選取 **[確定]** 以儲存變更，然後關閉 [憑證範本] 主控台。

1. 在憑證授權單位單位主控台中，以滑鼠右鍵按一下 [**憑證範本**]，選取 [**新增**]，然後選擇 [**要發出的憑證範本**]。

1. 在 [**啟用憑證範本**] 視窗中，選取新的範本。 例如， **CONFIGMGR MDM web 伺服器**。 然後選取 **[確定**] 以儲存並關閉視窗。

## <a name="request-the-certificate"></a><a name="bkmk_requestCert"></a>要求憑證

此程式描述如何要求 IIS 的 web 伺服器憑證。 針對裝載內部部署 MDM 其中一個角色的每個網站系統伺服器執行此程式。

1. 在裝載其中一個角色的網站系統伺服器上，以系統管理員身分開啟命令提示字元。 輸入`mmc`以開啟空白的 Microsoft 管理主控台。

1. 在主控台視窗中，移至 [檔案 **] 功能表，** 然後選取 [**新增/移除嵌入式管理單元**]。

    1. 從可用的嵌入式管理單元清單中選擇 [**憑證**]，然後選取 [**新增**]。

    1. 在 [憑證] 嵌入式管理單元視窗中，選擇 [**電腦帳戶**]。 選取 **[下一步**]，然後選取 **[完成]** 以管理本機電腦。

    1. 選取 **[確定]** 以結束 [新增或移除嵌入式管理單元] 視窗。

1. 展開 [**憑證（本機電腦）**]，然後選取 [**個人**] 存放區。 移至 [**動作**] 功能表，選取 [**所有**工作]，然後選擇 [**要求新憑證**]。 此動作會與 Active Directory 憑證服務通訊，以使用您先前建立的範本來建立新的憑證。

    1. 在 [憑證註冊嚮導] 的 [開始之前] 頁面上，選取 **[下一步]**。

    1. 在 [選取憑證註冊原則] 頁面上，選取 [ **Active Directory 註冊原則**]，然後選取 **[下一步]**。

    1. 選取您的 web 伺服器憑證範本（**CONFIGMGR MDM Web 服務器**），然後選取 [**註冊**]。

    1. 要求憑證之後，請選取 **[完成]**。

每部伺服器都需要唯一的 web 伺服器憑證。 針對裝載其中一個必要網站系統角色的每部伺服器重複此程式。 如果一部伺服器裝載了所有站台系統角色，您就只需要要求一個網頁伺服器憑證。

## <a name="bind-the-certificate"></a><a name="bkmk_bindCert"></a>系結憑證

下一個步驟是將新的憑證系結至 web 伺服器。 針對裝載*註冊點*和*註冊 proxy 點*網站系統角色的每部伺服器，遵循此程式。 如果一部伺服器裝載所有的網站系統角色，您只需要執行此程式一次。

> [!NOTE]
> 您不需要針對發佈點和裝置管理點網站系統角色執行此程式。 它們會在註冊期間自動接收所需的憑證。

1. 在裝載註冊點或註冊 proxy 點的伺服器上，移至 [**開始**] 功能表，選取 [系統**管理工具**]，然後選擇 [ **IIS 管理員**]。

1. 在連接清單中，選取 [**預設的網站**]，然後選取 [**編輯**系結]。

    1. 在 [網站系結] 視窗中，選取 [ **HTTPs**]，然後選取 [**編輯**]。

    1. 在 [編輯網站系結] 視窗中，為**SSL 憑證**選取新註冊的憑證。 選取 **[確定]** 以儲存，然後選取 [**關閉**]。

1. 在 [IIS 管理員] 主控台的 [連線] 清單中，選取 [web 伺服器]。 在右側的 [動作] 面板中，選取 [**重新開機**]。 此動作會重新開機網頁伺服器服務。

## <a name="export-the-trusted-root-certificate"></a><a name="bkmk_exportCert"></a>匯出受信任的根憑證

Active Directory 憑證服務會自動在所有已加入網域的裝置上，從 CA 安裝所需的憑證。 若要取得未加入網域的裝置與網站系統角色通訊所需的憑證，請將它從系結至 web 伺服器的憑證匯出。

1. 在 [IIS 管理員] 中，選取 [**預設的網站**]。 在右側的 [動作] 面板中 **，選取 [** 系結]。

1. 在 [網站系結] 視窗中，選取 [ **HTTPs**]，然後選取 [**編輯**]。

1. 選取網頁伺服器憑證，然後選取 [ **View**]。

1. 在 web 伺服器憑證的 [內容] 中，切換至 [**憑證路徑**] 索引標籤。選取憑證路徑的根目錄，然後選取 [**查看憑證**]。

1. 在根憑證的屬性中，切換至 [**詳細資料**] 索引標籤，然後選取 [**複製到**檔案]。

1. 在 [憑證匯出嚮導] 的 [歡迎使用] 頁面上，選取 **[下一步]**。

1. 選取 **[DER 編碼的二進位 x.509 （。CER）** 做為格式，然後選取 **[下一步]**。

1. 輸入路徑和檔案名，以識別此受信任的根憑證。 在 [檔案名] 中，按一下 **[流覽]**，選擇要儲存憑證檔案的位置，將檔案命名為，然後選取 **[下一步]**。

1. 檢查設定，然後選取 **[完成]** ，將憑證匯出至檔案。

視您的憑證授權單位單位設計而定，您可能需要匯出其他次級 CA 根憑證。 重複此程式，以在網頁伺服器憑證的憑證路徑中匯出其他憑證。

## <a name="next-step"></a>後續步驟

> [!div class="nextstepaction"]
> [設定裝置註冊](set-up-device-enrollment-on-premises-mdm.md)
